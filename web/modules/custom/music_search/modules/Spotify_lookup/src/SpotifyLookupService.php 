<?php

namespace Drupal\spotify_lookup;

use GuzzleHttp\ClientInterface;
use Drupal\Core\Config\ConfigFactoryInterface;

class SpotifyLookupService {

  protected $httpClient;
  protected $configFactory;

  public function __construct(ClientInterface $http_client, ConfigFactoryInterface $config_factory) {
    $this->httpClient = $http_client;
    $this->configFactory = $config_factory;
  }

  public function search($query) {
    $config = $this->configFactory->get('spotify_lookup.settings');
    $apiKey = $config->get('api_key');

    $url = 'https://api.spotify.com/v1/search?q=' . urlencoded($query) . '&type=artist,album,track';
    $response = $this->httpClient->request('GET', $url, [
      'headers' => [
        'Authorization' => 'Bearer ' . $apiKey,
      ],
    ]);

    return json_decode($response->getBody(), TRUE);
  }
}
